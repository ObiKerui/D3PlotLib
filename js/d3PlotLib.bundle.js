!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.d3PlotLib=e():t.d3PlotLib=e()}(self,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(){let t={},e=function(e,n){let r=[],l=[];n.forEach((t=>{let e=t.xs();r.push(e);let n=t.ys();Array.isArray(n[0])?l.push(...n):l.push(n)}));let o=e.chartWidth,s=e.chartHeight,a=t.xScale;"function"==typeof a&&(a=a(r[0],o));let i=t.yScale;"function"==typeof i&&(i=i(l,s)),a&&a.rangeRound([0,o]),i&&i.rangeRound([s,0]),e.xScale=a,e.yScale=i};function n(n){return function(r){return arguments.length?(t[n]=r,e):t[n]}}for(let r in t)!e[r]&&t.hasOwnProperty(r)&&(e[r]=n(r));return e.attr=function(){return t},e.xScale=function(n){return arguments.length?(t.xScale=n,e):e.xScale},e.yScale=function(n){return arguments.length?(t.yScale=n,e):e.yScale},e}t.r(e),t.d(e,{AxLine:()=>p,BarPlot:()=>f,BoxPlot:()=>N,CandlestickPlot:()=>A,Container:()=>i,DevBrush:()=>at,DevHexBinLayer:()=>rt,DevLabels:()=>st,DevMapContainer:()=>X,DevMapLayer:()=>Q,DevMapMarkers:()=>et,DevMapProjection:()=>Y,DevZoom:()=>lt,DonutPlot:()=>J,FillArea:()=>$,GroupedBarPlot:()=>y,Heatmap:()=>T,Hist:()=>x,Legend:()=>v,MapContainer:()=>B,MapLayer:()=>Z,MapMarkers:()=>F,MovingAverageCalc:()=>S,Plot:()=>u,Scaler:()=>n,ScatterPlot:()=>H,StackedArea:()=>M,StackedBar:()=>D,ViolinPlot:()=>P});const r={tag:null,xs:[],ys:[],labels:[],plotID:null,index:null,alpha:[],styles:[],colours:[],curve:null},l={tag:null,density:null,bins:null,colours:[]},o={tag:null,xs:[],ys:[],lineID:null,index:null,alpha:null,colours:null,labels:null,styles:null},s={legendID:null,index:null,data:null,position:null},a=Object.assign(Object.assign(Object.assign({},{xScale:null,yScale:null}),{svg:null,width:500,height:400,margin:{bottom:50,left:40,right:60,top:20},chartWidth:0,chartHeight:0,showMargins:!1,scale:null,legend:null}),{xAxis:null,xAxisLabel:"",xAxisPosition:"bottom",xAxisLabelOffset:30,xAxisText:{rotation:0},xAxisLabelEl:null,xTicks:5,xAxisShow:!0,xGrid:null,xGridShow:!1,yAxis:null,yAxisLabel:"",yAxisPosition:"left",yAxisLabelOffset:-30,yAxisLabelEl:null,yAxisPaddingBetweenChart:10,yTicks:5,yAxisShow:!0,yGrid:null,yGridShow:!0,yAxisText:{rotation:0}});function i(){let t=JSON.parse(JSON.stringify(a)),e=[];const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");function r(n){var r;t.chartWidth=t.width-t.margin.left-t.margin.right,t.chartHeight=t.height-t.margin.top-t.margin.bottom,r=n.node(),t.svg||(t.svg=d3.select(r).append("svg").classed("jschart-container",!0),function(e){let n=t.margin.left,r=t.margin.top,l=e.append("g").classed("container-group",!0).attr("transform",`translate(${n},${r})`);l.append("g").classed("x-axis-group grid",!0),l.append("g").classed("y-axis-group grid",!0),l.append("g").classed("chart-group",!0),l.append("g").classed("x-axis-group axis",!0),l.append("g").classed("x-axis-label",!0),l.append("g").classed("y-axis-group axis",!0),l.append("g").classed("y-axis-label",!0),l.append("g").classed("metadata-group",!0)}(t.svg)),t.svg.attr("width",t.width).attr("height",t.height),function(){let n=null==t.scale?null:t.scale;n&&n(t,e)}(),t.xAxis=t.yAxis=null,null!=t.xScale&&null!=t.yScale&&(t.xAxis=d3.axisBottom(t.xScale),"right"==t.yAxisPosition?t.yAxis=d3.axisRight(t.yScale):t.yAxis=d3.axisLeft(t.yScale),t.yAxis.ticks(10,"%").tickFormat((function(t){return t/1e3>=1&&(t=t/1e3+"K"),t}))),t.xGrid=t.yGrid=null,null!=t.xScale&&null!=t.yScale&&(t.xGrid=d3.axisBottom(t.xScale).tickSize(-t.chartHeight).tickFormat("").ticks(10),"right"==t.yAxisPosition?t.yGrid=d3.axisRight(t.yScale):t.yGrid=d3.axisLeft(t.yScale),t.yGrid.tickSize(-t.chartWidth).tickFormat("").ticks(10)),e.forEach((e=>{e(t)})),function(){let e=0;"right"==t.yAxisPosition&&(e=t.chartWidth+4),t.xGridShow&&t.xGrid&&t.svg.select(".x-axis-group.grid").attr("transform",`translate(0,${t.chartHeight})`).call(t.xGrid).style("opacity",.3),t.yGridShow&&t.yGrid&&t.svg.select(".y-axis-group.grid").attr("transform",`translate(${e})`).call(t.yGrid).style("opacity",.3)}(),function(){var e,n;let r=null!==(e=t.xAxisText.rotation)&&void 0!==e?e:0,l="middle",o="0em",s="1em";0!==r&&(l="start",o=".8em",s=".15em");let a=null!==(n=t.yAxisText.rotation)&&void 0!==n?n:0,i="0em";let c=0;"right"==t.yAxisPosition&&(c=t.chartWidth+4),t.xAxisShow&&t.xAxis&&(t.svg.select(".x-axis-group.axis").attr("transform",`translate(0,${t.chartHeight})`).call(t.xAxis),t.svg.select(".x-axis-group.axis").selectAll("text").style("font","10px Arial, sans-serif").style("text-anchor",l).attr("dx",o).attr("dy",s).attr("transform",`rotate(${r})`)),t.yAxisShow&&t.yAxis&&(t.svg.select(".y-axis-group.axis").attr("transform",`translate(${c}, 0)`).call(t.yAxis),t.svg.select(".y-axis-group.axis").selectAll("text").style("font","10px Arial, sans-serif").attr("transform",`rotate(${a})`))}(),function(){let e=0;"right"==t.yAxisPosition&&(e=t.chartWidth+80),t.yAxisLabel&&(t.yAxisLabelEl&&t.yAxisLabelEl.remove(),t.yAxisLabelEl=t.svg.select(".y-axis-label").attr("transform",`translate(${e}, 0)`).append("text").classed("y-axis-label-text",!0).attr("x",-t.chartHeight/2).attr("y",t.yAxisLabelOffset).attr("text-anchor","middle").attr("transform","rotate(270 0 0)").text(t.yAxisLabel)),t.xAxisLabel&&(t.xAxisLabelEl&&t.xAxisLabelEl.remove(),t.xAxisLabelEl=t.svg.select(".x-axis-label").attr("transform",`translate(0,${t.chartHeight})`).append("text").attr("y",t.xAxisLabelOffset).attr("text-anchor","middle").classed("x-axis-label-text",!0).attr("x",t.chartWidth/2).text(t.xAxisLabel))}(),null!=t.legend&&t.legend(t,e),t.showMargins&&t.svg&&t.svg.style("background-color","rgba(255, 0, 0, .2)")}let l=r;function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return r.on=function(t){let e=n.on.apply(n,arguments);return e===n?r:e},r.attr=function(){return t},r.plot=function(t){if(Number.isInteger(t)&&e.length>0)return e[t];if("string"==typeof t){let n=e.filter((e=>e.tag()===t));return n.length>0?n[0]:null}return e.push(t),r},r}const c=["red","green","blue","grey"];function u(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(r){e=r,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));if(r.filter(`g.${t.plotID}`).size()>0)return;t.index=r.size(),t.plotID=`plot-${t.index}`;let l=n.append("g").classed(`${t.plotID}`,!0),o=e.chartWidth,s=e.chartHeight;t.clipPathId=`${t.plotID}-clippath`,l.append("clipPath").attr("id",t.clipPathId).append("rect").attr("width",o+30).attr("height",s),t.index,t.colours=0===t.colours.length?c:t.colours}(),t.ys=Array.isArray(t.ys[0])?t.ys:[t.ys],t.labels=Array.isArray(t.labels)?t.labels:[t.labels],t.colours=Array.isArray(t.colours)?t.colours:[t.colours],t.styles=Array.isArray(t.styles)?t.styles:[t.styles],t.alpha=Array.isArray(t.alpha)?t.alpha:[t.alpha],function(){var r;let l=t.ys,o=t.xs,s=(t.index,t.colours),a=e.xScale,i=e.yScale,c=(e.width,e.height,t.alpha),u=(t.styles,""),d=null!==(r=t.curve)&&void 0!==r?r:d3.curveLinear,p=e.svg.select(`.${t.plotID}`).selectAll(".lines").data(l);p.exit().style("opacity",0).remove();let g=p.enter().append("path").classed("lines",!0).attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5);p=p.merge(g),p.attr("d",d3.line().curve(d).x((function(t,e){return a(o[e])})).y((function(t){return i(t)}))).attr("clip-path",`url(#${t.clipPathId})`).attr("stroke",((t,e)=>s[e])).style("opacity",((t,e)=>c[e])).style(u,"3, 3").on("mouseover",(function(t){d3.select(this).style("cursor","pointer"),n.call("customMouseOver",this,t)})).on("mousemove",(function(t){n.call("customMouseMove",this,t)})).on("mouseout",(function(t){n.call("customMouseOut",this,t)})).on("click",(function(t){n.call("customMouseClick",this,t)}))}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l.extent=function(){return{x:d3.extent(t.xs,(t=>t)),y:d3.extent(t.ys,(t=>t))}},l}const d=["red","green","blue","grey"];function p(){let t=JSON.parse(JSON.stringify(o)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=function(r){e=r,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));if(r.filter(`g.${t.lineID}`).size()>0)return;t.index=r.size(),t.lineID=`line-${t.index}`,n.append("g").classed(`${t.lineID}`,!0);let l=e.chartWidth,o=e.chartHeight;t.clipPathId=`${t.plotID}-clippath`,n.append("clipPath").attr("id",t.clipPathId).append("rect").attr("width",l+30).attr("height",o);let s=t.index%d.length;t.colour=d[s]}(),t.ys=Array.isArray(t.ys[0])?t.ys:[t.ys],t.labels=Array.isArray(t.labels)?t.labels:[t.labels],t.colours=Array.isArray(t.colours)?t.colours:[t.colours],t.styles=Array.isArray(t.styles)?t.styles:[t.styles],t.alpha=Array.isArray(t.alpha)?t.alpha:[t.alpha],function(){t.ys;let r=t.xs,l=t.colour,o=e.xScale,s=e.yScale,a=t.alpha,i=t.style,c="",u=e.svg;"--"==i&&(c="stroke-dasharray");let d=s.domain()[0],p=s.domain()[1],g=r,f=u.select(`.${t.lineID}`).selectAll(".lines").data(g);f.exit().style("opacity",0).remove();let h=f.enter().append("line").classed("lines",!0).attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5);f=f.merge(h),f.attr("x1",(function(t,e){return o(t)})).attr("x2",(function(t,e){return o(t)})).attr("y1",(function(t,e){return s(d)})).attr("y2",(function(t,e){return s(p)})).attr("clip-path",`url(#${t.clipPathId})`).attr("stroke",l).style("opacity",a).style(c,"3, 3").on("mouseover",(function(t){d3.select(this).style("cursor","pointer"),n.call("customMouseOver",this,t)})).on("mousemove",(function(t){n.call("customMouseMove",this,t)})).on("mouseout",(function(t){n.call("customMouseOut",this,t)})).on("click",(function(t){n.call("customMouseClick",this,t)}))}()};function l(e){return function(n){return arguments.length?(t[e]=n,r):t[e]}}for(let e in t)!r[e]&&t.hasOwnProperty(e)&&(r[e]=l(e));return r.on=function(t){let e=n.on.apply(n,arguments);return e===n?r:e},r.attr=function(){return t},r.extent=function(){return{x:d3.extent(t.xs,(t=>t)),y:d3.extent(t.ys,(t=>t))}},r}const g=Object.assign(Object.assign({},r),l);function f(){let t=null,e=JSON.parse(JSON.stringify(g));const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=function(r){t=r,function(){let n=t.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${e.plotID}`).size()>0||(e.index=r.size(),e.plotID=`bars-${r.size()}`,n.append("g").classed(`${e.plotID}`,!0))}(),function(){let r=e.ys,l=e.xs,o=t.xScale,s=t.yScale,a=t.chartHeight,i=t.svg,c=e.alpha,u=i.select(`.${e.plotID}`).selectAll(".bar").data(l);u.exit().style("opacity",0).remove();let d=u.enter().append("rect").classed("bar",!0);u=u.merge(d),u.attr("x",(t=>o(t))).attr("y",((t,e)=>s(r[e]))).attr("width",o.bandwidth()).attr("height",((t,e)=>a-s(r[e]))).attr("fill",(({value:t})=>"red")).style("opacity",c).on("mouseover",(function(t){d3.select(this).style("cursor","pointer"),n.call("customMouseOver",this,t)})).on("mousemove",(function(t){d3.select(this).style("cursor","pointer"),n.call("customMouseMove",this,t)})).on("mouseout",(function(t){n.call("customMouseOut",this,t)})).on("click",(function(t){n.call("customMouseClick",this,t)}))}()};function l(t){return function(n){return arguments.length?(e[t]=n,r):e[t]}}r.on=function(t){let e=n.on.apply(n,arguments);return e===n?r:e};for(let t in e)!r[t]&&e.hasOwnProperty(t)&&(r[t]=l(t));return r.extent=function(){return{x:d3.extent(e.xs,(t=>t)),y:d3.extent(e.ys,(t=>t))}},r}const h=Object.assign(Object.assign({},r),l);function y(){let t=null,e=JSON.parse(JSON.stringify(h));const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=function(n){t=n,function(){let n=t.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${e.plotID}`).size()>0||(e.index=r.size(),e.plotID=`bars-${r.size()}`,n.append("g").classed(`${e.plotID}`,!0))}(),function(){let n=e.ys,r=(e.xs,t.xScale),l=t.yScale,o=t.chartHeight,s=t.svg,a=["Nitrogen","normal","stress"],i=s.select(`.${e.plotID}`),c=d3.scaleBand().domain(a).range([0,r.bandwidth()]).padding([.05]),u=d3.scaleOrdinal().domain(a).range(["#e41a1c","#377eb8","#4daf4a"]),d=i.selectAll("g").data(n),p=d.enter().append("g");d.exit().remove(),d=d.merge(p),d.attr("transform",(function(t){return`translate(${r(t.group)},0)`}));let g=d.selectAll("rect").data((function(t){return a.map((function(e){return{key:e,value:t[e]}}))})),f=g.enter().append("rect");g=g.merge(f),g.attr("x",(function(t){return c(t.key)})).attr("y",(function(t){return l(t.value)})).attr("width",c.bandwidth()).attr("height",(function(t){return o-l(t.value)})).attr("fill",(function(t){return u(t.key)}))}()};function l(t){return function(n){return arguments.length?(e[t]=n,r):e[t]}}r.on=function(t){let e=n.on.apply(n,arguments);return e===n?r:e};for(let t in e)!r[t]&&e.hasOwnProperty(t)&&(r[t]=l(t));return r.extent=function(){return{x:d3.extent(e.xs,(t=>t)),y:d3.extent(e.ys,(t=>t))}},r}const m=Object.assign(Object.assign({},r),l);function x(){let t=null,e=JSON.parse(JSON.stringify(m));const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=function(r){t=r,function(){let n=t.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${e.plotID}`).size()>0||(e.index=r.size(),e.plotID=`bars-${r.size()}`,n.append("g").classed(`${e.plotID}`,!0))}(),function(){let r=e.ys,l=(e.xs,t.xScale),o=t.yScale,s=t.chartHeight,a=(t.chartWidth,t.svg),i=e.bins,c=e.alpha,u=e.density,d=a.select(`.${e.plotID}`),p=function(n,r){e.xs;let l=t.xScale,o=d3.extent(n);return o[1],o[0],d3.bin().domain(l.domain()).thresholds(r)(n)}(r,i),g=d3.reduce(p,((t,e)=>e.length>t?e.length:t),0),f=g;if(u){let t=0;if(p.length>0){let e=p[0];t=e.x1-e.x0}f=g/(r.length*t)}o.domain()[1]<f&&o.domain([0,f]);let h=d.selectAll(".bar").data(p);h.exit().style("opacity",0).remove();let y=h.enter().append("rect").classed("bar",!0);h=h.merge(y),h.attr("x",(t=>l(t.x0))).attr("y",((t,e)=>{let n=t.length;return u&&(n=t.length/(r.length*(t.x1-t.x0))),o(n)})).attr("width",(t=>l(t.x1)-l(t.x0))).attr("height",((t,e)=>{let n=t.length;return u&&(n=t.length/(r.length*(t.x1-t.x0))),n=s-o(n),n})).attr("fill",(({value:t})=>"red")).style("opacity",c).on("mouseover",(function(t){d3.select(this).style("cursor","pointer"),n.call("customMouseOver",this,t)})).on("mousemove",(function(t){d3.select(this).style("cursor","pointer"),n.call("customMouseMove",this,t)})).on("mouseout",(function(t){n.call("customMouseOut",this,t)})).on("click",(function(t){n.call("customMouseClick",this,t)}))}()};function l(t){return function(n){return arguments.length?(e[t]=n,r):e[t]}}r.on=function(t){let e=n.on.apply(n,arguments);return e===n?r:e};for(let t in e)!r[t]&&e.hasOwnProperty(t)&&(r[t]=l(t));return r.extent=function(){return{x:d3.extent(e.xs,(t=>t)),y:d3.extent(e.ys,(t=>t))}},r}function v(){let t=JSON.parse(JSON.stringify(s)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=function(n,r){e=n,function(){let n=e.svg.select("g.metadata-group"),r=n.selectAll((function(){return this.childNodes}));if(r.filter(`g.${t.legendID}`).size())return;t.index=r.size(),t.legendID=`legend-${t.index}`;let l=n.append("g").classed(`${t.legendID}`,!0).append("g").classed("anchorpoint",!0);l.append("rect").classed("background",!0),l.append("g").classed("innermargin",!0)}(),function(e){let n=e.map((t=>{let e=t.labels()?t.labels():["none"],n=t.colours()?t.colours():["white"];return e.map(((t,e)=>({label:t,colour:n[e]})))}));t.legendData=[].concat.apply([],n)}(r),function(){var n;let r=e.svg.select(`.${t.legendID}`).select("g.anchorpoint"),l=r.select("rect.background"),o=r.select("g.innermargin"),s=t.legendData,a=10,i=null!==(n=t.position)&&void 0!==n?n:"topleft",c=e.chartWidth,u=e.chartHeight,[d,p]=function(t,e,n){let r=0,l=0;switch(t){case"topleft":r=0,l=0;break;case"topright":r=.6*e,l=0;break;case"middleleft":r=0,l=.5*n;break;case"middleright":r=.6*e,l=.5*n;break;case"bottomleft":r=0,l=.6*n;break;case"bottomright":r=.6*e,l=.6*n}return[r,l]}(i,c,u);d+=.05*c,p+=.05*u,r.attr("transform",`translate(${d},${p})`),o.attr("transform","translate(5,5)"),l.attr("x",0).attr("y",0).attr("width",100).attr("height",100).style("fill","white").style("stroke","lightgrey").style("opacity",.95);let g=o.selectAll("rect").data(s);g.exit().style("opacity",0).remove();let f=g.enter().append("rect");g=g.merge(f),g.attr("x",0).attr("y",(function(t,e){return 15*e})).attr("width",a).attr("height",a).style("fill",(function(t){return t.colour}));let h=o.selectAll("text").data(s);h.exit().style("opacity",0).remove();let y=h.enter().append("text");h=h.merge(y),h.attr("x",12).attr("y",(function(t,e){return 15*e+5})).style("fill",(function(t){return t.colour})).text((function(t){return t.label})).attr("text-anchor","left").style("alignment-baseline","middle").style("font-size",".8em")}()};function l(e){return function(n){return arguments.length?(t[e]=n,r):t[e]}}for(let e in t)!r[e]&&t.hasOwnProperty(e)&&(r[e]=l(e));return r.on=function(t){let e=n.on.apply(n,arguments);return e===n?r:e},r.attr=function(){return t},r}const b=["red","green","blue","grey"];function M(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(n){e=n,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0),t.index,t.colours=b)}(),function(){let n=t.xs,r=t.ys,l=t.labels,o=(t.index,t.colour,e.xScale),s=e.yScale,a="";t.alpha,t.style;let i=e.svg.select(`.${t.plotID}`),c=d3.scaleOrdinal().domain(l).range(t.colours),u=function(t,e,n){let r=e.length,l=e[0].length,o=[];for(let t=0;t<l;t++){let l={};for(let o=0;o<r;o++){let r=e[o];l[n[o]]=r[t]}o.push(l)}return o}(0,r,l),d=d3.stack().keys(l).order(d3.stackOrderDescending)(u),p=d3.area().x(((t,e)=>o(n[e]))).y0(((t,e)=>s(t[0]))).y1(((t,e)=>s(t[1]))),g=i.selectAll(".layer").data(d);g.exit().remove(),g.enter().append("g").attr("class","layer").append("path").attr("class","area").style("fill",(t=>c(t.key))).attr("d",((t,e)=>p(t,e)))}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l}const O=["red","green","blue","grey"];function A(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(r){e=r,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));if(r.filter(`g.${t.plotID}`).size()>0)return;t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0);let l=t.index%O.length;t.colour=O[l]}(),function(){let r=t.xs,l=t.ys,o=(t.labels,t.index,t.colour,e.xScale),s=e.yScale,a=e.svg.select(`.${t.plotID}`),i=a.selectAll(".bar").data(l);i.exit().style("opacity",0).remove();let c=i.enter().append("rect").classed("bar",!0);i=i.merge(c),i.attr("x",((t,e)=>o(r[e]))).attr("y",(({open:t,close:e})=>s(Math.max(t,e)))).attr("width",10).attr("height",(({open:t,close:e})=>t==e?1:s(Math.min(t,e))-s(Math.max(t,e)))).attr("fill",(({open:t,close:e})=>t===e?"silver":t>e?"red":"green")).on("mouseover",(function(t){d3.select(this).style("cursor","pointer"),n.call("customMouseOver",this,t)})).on("mousemove",(function(t){n.call("customMouseMove",this,t)})).on("mouseout",(function(t){n.call("customMouseOut",this,t)})).on("click",(function(t){n.call("customMouseClick",this,t)}));let u=a.selectAll(".sticks").data(l);u.exit().style("opacity",0).remove();let d=u.enter().append("line").attr("class","sticks");u=u.merge(d),u.attr("x1",(t=>o(t.date)+5)).attr("x2",(t=>o(t.date)+5)).attr("y1",(t=>s(t.high))).attr("y2",(t=>s(t.low))).attr("stroke",(t=>t.open===t.close?"white":t.open>t.close?"red":"green"))}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l}function S(){let t=1;function e(e,r){let l=r?e.map(r):e,o=(t%2==0?t:t+1)/2;var s,a,i;return s=o,a=o,i=l,_.chain(i).map(function(t,e){return function(n,r,l){const o=Math.max(0,r-t),s=Math.min(l.length,r+e+1);return _.slice(l,o,s)}}(s,a)).map(n).value()}function n(t){return function(t){return _.reduce(t,((t,e)=>t+e),0)}(t)/(t.length||1)}let r=e;return e.window_size=function(e){return arguments.length?(t=e,r):t},e}const w=["red","green","blue","grey"];function $(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(n){e=n,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));if(r.filter(`g.${t.plotID}`).size()>0)return;t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0);let l=t.index%w.length;t.colour=w[l]}(),function(){let n=t.xs,r=t.ys,l=t.where,o=t.labels,s=t.colours,a=e.xScale,i=e.yScale,c=function(t){let e=t.xs,n=t.ys,r=t.where;function l(t,e,n,r,l){return r+(n-t)/(e-t)*(l-r)}return function(){let{startDataIdx:t,startIdx:o,endIdx:s,endDataIdx:a}=function(){let t=0,n=0,l=e.length>0?e.length-1:0,o=l;for(let l=0;l<e.length;l++){if(r(e[l])){n=l;break}t=l}for(let t=n;t<e.length;t++){if(!1===r(e[t])){o=t;break}l=t}return{startDataIdx:t,startIdx:n,endIdx:l,endDataIdx:o}}(),i=e.slice(o,s+1),c=n.slice(o,s+1);if(t<o){let s=e[t],a=e[o],u=function(t,e,n){let r=t,l=e,o=e;for(let t=0;t<4;t++)o=l-.5*(l-r),n(o)?l=o:r=o;return o}(s,a,r);i.unshift(u);let d=l(s,a,u,n[t],n[o]);c.unshift(d)}if(s<a){let t=e[a],o=e[s],u=function(t,e,n){let r=e,l=t,o=e;for(let t=0;t<4;t++)o=l-.5*(l-r),n(o)?r=o:l=o;return o}(t,o,r);i.push(u);let d=n[a],p=l(o,t,u,n[s],d);c.push(p)}return{newXs:i,newYs:c}}}({xs:n,ys:r,where:l}),{newXs:u,newYs:d}=c(),p=t.alpha,g="";t.style;let f=e.svg.select(`.${t.plotID}`),h=d3.scaleOrdinal().domain(o).range(s),y=d3.area().x(((t,e)=>a(u[e]))).y0(((t,e)=>{let n=i.domain()[0];return i(n)})).y1(((t,e)=>i(t))),m=f.selectAll("path").data([d]);m.exit().remove();let x=m.enter().append("path").attr("class","fill_between");m=m.merge(x),m.style("fill",(t=>h(t.key))).style("opacity",p).attr("d",((t,e)=>y(t,e)))}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l.where=function(e){return arguments.length?(t.where=e,l):t.where},l}const k=["red","green","blue","grey"];function D(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(n){e=n,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0),t.index,t.colours=k)}(),function(){let n=t.xs,r=t.ys,l=t.labels,o=(t.index,t.colour,e.xScale),s=e.yScale,a="";t.alpha,t.style;let i=e.svg.select(`.${t.plotID}`),c=d3.scaleOrdinal().domain(l).range(t.colours),u=function(t,e,n){let r=e.length,l=e[0].length,o=[];for(let t=0;t<l;t++){let l={};for(let o=0;o<r;o++){let r=e[o];l[n[o]]=r[t]}o.push(l)}return o}(0,r,l),d=d3.stack().keys(l).order(d3.stackOrderDescending)(u);var p=i.selectAll(".layer").data(d);p.enter().append("g").attr("class","layer").style("fill",(function(t,e){return c(t.key)})).selectAll("rect").data((function(t){return t})).enter().append("rect").attr("x",(function(t,e){return o(n[e])})).attr("y",(function(t){return s(t[1])})).attr("height",(function(t){return s(t[0])-s(t[1])})).attr("width",o.bandwidth()),p.exit().remove()}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l}const I=["red","green","blue","grey"];function N(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(n){e=n,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0),t.index,t.colours=I)}(),function(){let n=t.ys,r=t.labels,l=e.xScale,o=e.yScale,s=e.svg.select(`.${t.plotID}`),a=function(t){return t.map((t=>{let e=t.sort(d3.ascending),n=d3.quantile(e,.25),r=d3.quantile(e,.5),l=d3.quantile(e,.75),o=l-n;return{q1:n,median:r,q3:l,interQuantileRange:o,min:n-1.5*o,max:l+1.5*o}}))}(n),i=s.selectAll("vertLines").data(a);i.exit().remove();let c=i.enter().filter((t=>!1===Number.isNaN(t.min))).append("line");i=i.merge(c),i.attr("x1",(function(t,e){return l(r[e])})).attr("x2",(function(t,e){return l(r[e])})).attr("y1",(function(t){return o(t.min)})).attr("y2",(function(t){return o(t.max)})).attr("stroke","black").style("width",40);let u=100,d=s.selectAll("boxes").data(a);d.exit().remove();let p=d.enter().filter((t=>!1===Number.isNaN(t.min))).append("rect");d=p.merge(p),d.attr("x",(function(t,e){return l(r[e])-50})).attr("y",(function(t){return o(t.q3)})).attr("height",(function(t){return o(t.q1)-o(t.q3)})).attr("width",u).attr("stroke","black").style("fill","#69b3a2");let g=s.selectAll("medianLines").data(a);g.exit().remove();let f=g.enter().filter((t=>!1===Number.isNaN(t.min))).append("line");g=g.merge(f),g.attr("x1",(function(t,e){return l(r[e])-50})).attr("x2",(function(t,e){return l(r[e])+50})).attr("y1",(function(t){return o(t.median)})).attr("y2",(function(t){return o(t.median)})).attr("stroke","black").style("width",80)}(),function(){let n=t.ys,r=t.labels,l=e.xScale,o=e.yScale,s=e.svg.select(`.${t.plotID}`),a=s.selectAll("indPoints").data(n);a.exit().remove();let i=a.enter().filter((t=>!1===Number.isNaN(t.min))).append("g");a=a.merge(i),a.attr("transform",((t,e)=>`translate(${l(r[e])},0)`));let c=a.selectAll("circle").data((t=>t));c.exit().remove();let u=c.enter().append("circle");c=c.merge(u),c.attr("cx",(function(t,e){return 50*Math.random()-25})).attr("cy",(function(t){return o(t)})).attr("opacity",.2).attr("r",4).style("fill","white").attr("stroke","black")}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l.extent=function(){return{x:d3.extent(t.xs,(t=>t)),y:d3.extent(t.ys,(t=>t))}},l}const z=["red","green","blue","grey"];function P(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(n){e=n,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0),t.index,t.colours=z)}(),function(){let n=t.ys,r=t.labels,l=e.xScale,o=e.yScale,s=e.svg.select(`.${t.plotID}`),a=function(n){var r;let l=e.yScale,o=null!==(r=t.bins)&&void 0!==r?r:100,s=d3.bin().domain(l.domain()).thresholds(o);return n.map((t=>s(t)))}(n),i=0,c=0;var u=0;for(let t in a)i=a[t].map((function(t){return t.length})),c=d3.max(i),c>u&&(u=c);let d=l.bandwidth(),p=d3.scaleLinear().range([0,d]).domain([-c,c]),g=s.selectAll("myViolin").data(a);g.exit().remove();let f=g.enter().append("g"),h=f.append("path");g=g.merge(f),g.attr("transform",((t,e)=>`translate(${l(r[e])},0)`));let y=g.selectAll("path").datum((t=>t));y=y.merge(h),y.attr("d",(t=>d3.area().x0((t=>p(-t.length))).x1((t=>p(t.length))).y((t=>o(t.x0))).curve(d3.curveCatmullRom)(t))).style("stroke","none").style("fill","#69b3a2")}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l.extent=function(){return{x:d3.extent(t.xs,(t=>t)),y:d3.extent(t.ys,(t=>t))}},l}const j=["red","green","blue","grey"];function J(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(n){e=n,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0),t.index,t.colours=j)}(),function(){let n=t.ys,r=t.labels,l=e.chartWidth,o=e.chartHeight,s=e.svg.select(`.${t.plotID}`),a=Math.min(l,o)/2-0,i=s.attr("transform",`translate(${l/2}, ${o/2})`),c=d3.scaleOrdinal().domain(r).range(d3.schemeDark2),u=function(t){return d3.pie()(t)}(n),d=d3.arc().innerRadius(.5*a).outerRadius(.8*a),p=d3.arc().innerRadius(.9*a).outerRadius(.9*a),g=i.selectAll("allSlices").data(u);g.exit().remove();let f=g.enter().append("path");g=g.merge(f),g.attr("d",d).attr("fill",(function(t,e){return c(r[e])})).attr("stroke","white").style("stroke-width","2px").style("opacity",.7);let h=i.selectAll("allPolylines").data(u);h.exit().remove();let y=h.enter().append("polyline");h=h.merge(y),h.attr("stroke","black").style("fill","none").attr("stroke-width",1).attr("points",(function(t){let e=d.centroid(t),n=p.centroid(t),r=p.centroid(t),l=t.startAngle+(t.endAngle-t.startAngle)/2;return r[0]=.95*a*(l<Math.PI?1:-1),[e,n,r]}));let m=i.selectAll("allLabels").data(u);m.exit().remove();let x=m.enter().append("text");m=m.merge(x),m.text((function(t,e){return r[e]})).attr("transform",(function(t){var e=p.centroid(t),n=t.startAngle+(t.endAngle-t.startAngle)/2;return e[0]=.99*a*(n<Math.PI?1:-1),`translate(${e})`})).style("text-anchor",(function(t){return t.startAngle+(t.endAngle-t.startAngle)/2<Math.PI?"start":"end"}))}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l.extent=function(){return{x:d3.extent(t.xs,(t=>t)),y:d3.extent(t.ys,(t=>t))}},l}const C=["red","green","blue","grey"];function H(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(n){e=n,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0),t.index,t.colours=C)}(),function(){var n,r;let l=t.ys,o=t.xs,s=(t.index,t.colours,e.xScale),a=e.yScale,i=null!==(n=t.colours)&&void 0!==n?n:["red","green","blue","gray","black"],c=(t.alpha,t.styles,null!==(r=t.curve)&&void 0!==r||d3.curveLinear,e.svg.select(`.${t.plotID}`).selectAll("g").data(l)),u=c.enter().append("g");c.exit().remove(),c=c.merge(u);let d=c.selectAll("circle").data(((t,e)=>t.map((t=>({elem:t,i:e}))))),p=d.enter().append("circle").filter((t=>!1===Number.isNaN(t.elem)));d.exit().remove(),d=d.merge(p),d.attr("cx",(function(t,e){return s(o[e])})).attr("cy",(function(t){return a(t.elem)})).attr("r",1.5).style("fill",(t=>i[t.i]))}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l.extent=function(){return{x:d3.extent(t.xs,(t=>t)),y:d3.extent(t.ys,(t=>t))}},l}const E=["red","green","blue","grey"];function T(){let t=JSON.parse(JSON.stringify(r)),e=null;const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let l=function(n){e=n,function(){let n=e.svg.select("g.chart-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`plot-${t.index}`,n.append("g").classed(`${t.plotID}`,!0),t.index,t.colours=E)}(),function(){var n;let r=t.ys,l=(t.xs,t.index,t.colours,e.xScale),o=e.yScale,s=(t.alpha,t.styles,null!==(n=t.curve)&&void 0!==n||d3.curveLinear,d3.scaleThreshold().domain([.85,1]).range(["#2980B9","#E67E22","#27AE60","#27AE60"])),a=e.svg.select(`.${t.plotID}`).selectAll("g").data(r),i=a.enter().append("g").append("rect");a.exit().remove(),a=a.merge(i),a.attr("class","cell").attr("width",l.bandwidth()).attr("height",o.bandwidth()).attr("y",(function(t){return o(t.country)})).attr("x",(function(t){return l(t.product)})).attr("fill",(function(t){return s(t.value)}))}()};function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return l.on=function(t){let e=n.on.apply(n,arguments);return e===n?l:e},l.attr=function(){return t},l.extent=function(){return{x:d3.extent(t.xs,(t=>t)),y:d3.extent(t.ys,(t=>t))}},l}const W={map:null,div:null,svg:null,width:500,height:400,margin:{bottom:50,left:40,right:60,top:20},mapWidth:0,mapHeight:0,showMargins:!1,projector:null,zoomer:null,legend:null,position:null,zoom:10,accessToken:null,viewType:null},G={tag:null,geojson:[],data:[],labels:[],plotID:null,index:null,alpha:[],styles:[],colours:[],curve:null},q=Object.assign(Object.assign({},W),G);function B(){let t=JSON.parse(JSON.stringify(q)),e=[];const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");function r(n){t.showMargins&&t.svg.style("background-color","rgba(255, 0, 0, .2)"),t.chartWidth=t.width-t.margin.left-t.margin.right,t.chartHeight=t.height-t.margin.top-t.margin.bottom,function(e){t.viewType;let n=e,r=(t.accessToken,t.zoom),l=t.position;t.map||(t.map=L.map(n.node()).setView(l,r),L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:18,tileSize:512,zoomOffset:-1}).addTo(t.map),L.svg().addTo(t.map))}(n),function(e){let n=null,r=t.map;if(!t.svg){n=e.append("div").classed("custom-map-element",!0).style("height",t.height).style("width",t.width);const l=d3.select(r.getPanes().overlayPane);t.svg=l.select("svg"),t.svg.append("g").classed("map-group",!0)}}(n),t.map.on("zoomend",(()=>{e.forEach((e=>{e(t)}))})),e.forEach((e=>{e(t)}))}let l=r;function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return r.on=function(t){let e=n.on.apply(n,arguments);return e===n?r:e},r.attr=function(){return t},r.plot=function(t){if(Number.isInteger(t)&&e.length>0)return e[t];if("string"==typeof t){let n=e.filter((e=>e.tag()===t));return n.length>0?n[0]:null}return e.push(t),r},r}const R=Object.assign({},G);function F(){let t=JSON.parse(JSON.stringify(R)),e=null;function n(n){e=n,function(){let n=e.svg.select("g.map-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`markers-${r.size()}`,n.append("g").classed(`${t.plotID}`,!0))}(),function(){let n=e.map,r=e.svg,l=(function(t){const e=d3.geoTransform({point:function(e,n){const r=t.latLngToLayerPoint(new L.LatLng(n,e));this.stream.point(r.x,r.y)}});d3.geoPath().projection(e)}(n),t.data);let o=r.select(`.${t.plotID}`).selectAll(".boundary").data(l);o.exit().style("opacity",0).remove();let s=o.enter().append("path").classed("boundary",!0);o=o.merge(s),o.attr("d",((t,e,n)=>d3.symbol().type(d3.symbolSquare).size(45)())).attr("transform",(function(t,e,r){let l=t.latlong,o=n.latLngToLayerPoint(new L.LatLng(l[0],l[1]));return`translate(${o.x},${o.y})`})).styles({stroke:"Orange","stroke-width":"1px",fill:"blue"})}()}d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=n;function l(e){return function(n){return arguments.length?(t[e]=n,r):t[e]}}for(let e in t)!r[e]&&t.hasOwnProperty(e)&&(r[e]=l(e));return n.attr=function(){return t},n}const V=Object.assign({},G);function Z(){let t=JSON.parse(JSON.stringify(V)),e=null;function n(n){e=n,function(){let n=e.svg.select("g.map-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`layer-${r.size()}`,n.append("g").classed(`${t.plotID}`,!0))}(),function(){let n=e.map,r=e.svg,l=function(t){const e=d3.geoTransform({point:function(e,n){const r=t.latLngToLayerPoint(new L.LatLng(n,e));this.stream.point(r.x,r.y)}});return d3.geoPath().projection(e)}(n),o=t.geojson,s=n.getZoom();const a={stroke:"Orange","stroke-width":"1px","fill-opacity":".3",fill:"green"};let i=r.select(`.${t.plotID}`).selectAll(".boundary").data(o.features);i.exit().style("opacity",0).remove();let c=i.enter().append("path").classed("boundary",!0);i=i.merge(c),i.attr("d",(t=>l(t))).styles((e=>t.onStyle?t.onStyle({elem:e,zoomLevel:s}):a))}()}d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=n;function l(e){return function(n){return arguments.length?(t[e]=n,r):t[e]}}for(let e in t)!r[e]&&t.hasOwnProperty(e)&&(r[e]=l(e));return n.attr=function(){return t},n.onStyle=function(e){return arguments.length?(t.onStyle=e,n):t.onStyle},n}const U=Object.assign(Object.assign({},W),G);function X(){let t=JSON.parse(JSON.stringify(U)),e=[];const n=d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");function r(n){var r;t.mapWidth=t.width-t.margin.left-t.margin.right,t.mapHeight=t.height-t.margin.top-t.margin.bottom,r=n.node(),t.svg||(t.svg=d3.select(r).append("svg").classed("devgenmap-container",!0),function(e){let n=t.margin.left,r=t.margin.top,l=e.append("g").classed("container-group",!0).attr("transform",`translate(${n},${r})`);l.append("g").classed("map-group",!0),l.append("g").classed("metadata-group",!0)}(t.svg)),t.svg.attr("width",t.width).attr("height",t.height),function(){let n=null==t.projector?null:t.projector;n&&n(t,e)}(),e.forEach((e=>{e(t)})),t.showMargins&&t.svg.style("background-color","rgba(255, 0, 0, .2)"),function(){let n=null==t.zoomer?null:t.zoomer;n&&n(t,e)}()}let l=r;function o(e){return function(n){return arguments.length?(t[e]=n,l):t[e]}}for(let e in t)!l[e]&&t.hasOwnProperty(e)&&(l[e]=o(e));return r.on=function(t){let e=n.on.apply(n,arguments);return e===n?r:e},r.attr=function(){return t},r.plot=function(t){if(Number.isInteger(t)&&e.length>0)return e[t];if("string"==typeof t){let n=e.filter((e=>e.tag()===t));return n.length>0?n[0]:null}return e.push(t),r},r}function Y(){let t={},e=function(e,n){let r=[],l=e.mapWidth,o=e.mapHeight;n.forEach((t=>{let e=t.geojson();"object"!=typeof e||Array.isArray(e)||null===e||(r=e)})),console.log("geojson list: ",r);let s=function(e,n,r){const l=t.projection,o=d3.geoPath().projection(l);l.scale(1).translate([0,0]);var s=o.bounds(e);const a=s[0],i=a[0],c=a[1],u=s[1],d=u[0],p=u[1],g=Math.abs(d-i)/n,f=Math.abs(p-c)/r,h=1/Math.max(g,f);let y=h*(d+i);y=(n-y)/2;let m=h*(p+c);m=(r-m)/2;const x=[y,m];return l.scale(h).translate(x),o}(r,l,o);e.projector=s};function n(n){return function(r){return arguments.length?(t[n]=r,e):t[n]}}for(let r in t)!e[r]&&t.hasOwnProperty(r)&&(e[r]=n(r));return e.attr=function(){return t},e.projection=function(n){return arguments.length?(t.projection=n,e):e.projection},e}const K=Object.assign({},G);function Q(){let t=JSON.parse(JSON.stringify(K)),e=null;function n(n){e=n,function(){let n=e.svg.select("g.map-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`layer-${r.size()}`,n.append("g").classed(`${t.plotID}`,!0))}(),function(){let n=e.svg,r=t.geojson,l=e.projector;const o={stroke:"Brown","stroke-opacity":".2","stroke-width":"1px","fill-opacity":".1",fill:"green"};let s=n.select(`.${t.plotID}`).selectAll(".boundary").data(r.features);s.exit().style("opacity",0).remove();let a=s.enter().append("path").classed("boundary",!0);s=s.merge(a),s.attr("d",(t=>l(t))).styles((e=>t.onStyle?t.onStyle({elem:e}):o))}()}d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=n;function l(e){return function(n){return arguments.length?(t[e]=n,r):t[e]}}for(let e in t)!r[e]&&t.hasOwnProperty(e)&&(r[e]=l(e));return n.attr=function(){return t},n.onStyle=function(e){return arguments.length?(t.onStyle=e,n):t.onStyle},n.feature=function(e){return arguments.length?(t.feature=e,n):t.feature},n}const tt=Object.assign({},G);function et(){let t=JSON.parse(JSON.stringify(tt)),e=null;function n(n){e=n,function(){let n=e.svg.select("g.map-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`markers-${r.size()}`,n.append("g").classed(`${t.plotID}`,!0))}(),function(){let n=e.svg,r=t.data,l=e.projector;let o=n.select(`.${t.plotID}`).selectAll(".boundary").data(r);o.exit().style("opacity",0).remove();let s=o.enter().append("path").classed("boundary",!0);o=o.merge(s),o.attr("d",((t,e,n)=>d3.symbol().type(d3.symbolSquare).size(45)())).attr("transform",(function(t,e,n){let r=[+t.long,+t.lat],o=l.projection()(r);return`translate(${o[0]}, ${o[1]})`})).styles({stroke:"brown","stroke-width":"1px",fill:"red"})}()}d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=n;function l(e){return function(n){return arguments.length?(t[e]=n,r):t[e]}}for(let e in t)!r[e]&&t.hasOwnProperty(e)&&(r[e]=l(e));return n.attr=function(){return t},n}const nt=Object.assign({},G);function rt(){let t=JSON.parse(JSON.stringify(nt)),e=null;function n(n){e=n,function(){let n=e.svg.select("g.map-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`layer-${r.size()}`,n.append("g").classed(`${t.plotID}`,!0))}(),function(){let n=e.svg,r=t.geojson,l=t.datapoints,o=e.projector.projection(),s=n.select(`.${t.plotID}`),a=r.features[0].geometry.coordinates[0][0].map((t=>o(t))),i=function(t){const n=e.mapWidth,r=e.mapHeight;console.log("map height / width: ",e);const l=n/t,o=Math.floor(r/l);return d3.range(o*t).map(((e,n)=>({x:Math.floor(n%t*l),y:Math.floor(n/t)*l,datapoint:0})))}(160).filter((t=>d3.polygonContains(a,[t.x,t.y]))),c=function(t,e){return t.map((t=>{let n=e([+t.lng,+t.lat]);return{x:n[0],y:n[1],datapoint:1,name:t.MarketName,state:t.State,city:t.city,url:t.Website}}))}(l,o),u=i.concat(c),d=d3.hexbin().radius(4).x((t=>t.x)).y((t=>t.y)),p=d(u),{rolledUpData:g,maxLength:f}=function(t){let e=0,n=[];return t.forEach((t=>{let r=[];t.forEach((t=>{1===t.datapoint&&r.push(t)}));let l={x:t.x,y:t.y,data:r};n.push(l),e=r.length>e?r.length:e})),{rolledUpData:n,maxLength:e}}(p),h=d3.scaleSequential((t=>{let e=Math.pow(t,10);return d3.interpolateViridis(e)})).domain([f,1]),y=(d3.scaleSqrt().domain([0,f]).range([3.5,15]),s.selectAll(".hexes").data(g));y.exit().style("opacity",0).remove();let m=y.enter().append("path").classed("hexes",!0);y=m.merge(y),y.attr("transform",(t=>`translate(${t.x}, ${t.y})`)).attr("d",(t=>d.hexagon())).style("fill",(t=>h(t.data.length))).style("opacity","0.8")}()}d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=n;function l(e){return function(n){return arguments.length?(t[e]=n,r):t[e]}}for(let e in t)!r[e]&&t.hasOwnProperty(e)&&(r[e]=l(e));return n.attr=function(){return t},n.onStyle=function(e){return arguments.length?(t.onStyle=e,n):t.onStyle},n.datapoints=function(e){return arguments.length?(t.datapoints=e,n):t.datapoints},n}function lt(){let t,e={},n=null,r=function(e,r){let l=e.mapWidth,o=e.mapHeight,s=e.svg.select("g.map-group"),a=e.svg.select("g.metadata-group");if(null===n){function i(e,n,r){let l=d3.event.transform;var o;o=()=>{s.attr("transform",l)},t||(t=!0,setTimeout((()=>{o(),t=!1}),10))}let c=d3.zoom().on("zoom",i).scaleExtent([1,5]).translateExtent([[0,0],[l,o]]);console.log("what is map group here: ",s),s.call(c),console.log("zoom params: ",e,r,s),a.append("g").classed("zoom-details",!0),n={}}};function l(t){return function(n){return arguments.length?(e[t]=n,r):e[t]}}for(let t in e)!r[t]&&e.hasOwnProperty(t)&&(r[t]=l(t));return r.attr=function(){return e},r}const ot=Object.assign({},G);function st(){let t=JSON.parse(JSON.stringify(ot)),e=null;function n(n){e=n,function(){let n=e.svg.select("g.map-group"),r=n.selectAll((function(){return this.childNodes}));r.filter(`g.${t.plotID}`).size()>0||(t.index=r.size(),t.plotID=`labels-${r.size()}`,n.append("g").classed(`${t.plotID}`,!0))}(),function(){let n=e.svg,r=t.data,l=e.projector,o=[],s=n.select(`.${t.plotID}`).selectAll(".label").data(r);s.exit().style("opacity",0).remove();let a=s.enter().append("g").classed("label",!0);s=s.merge(a);let i=s.attr("transform",(function(t,e,n){let r=[+t.long,+t.lat],o=l.projection()(r);return`translate(${o[0]}, ${o[1]})`}));i.append("text").attr("x",8).attr("dy","0em").text((t=>t.name)).style("font-size",12).each(((t,e,n)=>{let r=n[e].getComputedTextLength();o.push(r)})),i.append("rect").lower().attr("x",6).attr("y","-1.1em").attr("width",((t,e)=>o[e]+8)).attr("height",20).attr("stroke","gray").attr("stroke-opacity",.2).attr("fill","#fff").style("opacity",.8)}()}d3.dispatch("customMouseOver","customMouseMove","customMouseOut","customMouseClick");let r=n;function l(e){return function(n){return arguments.length?(t[e]=n,r):t[e]}}for(let e in t)!r[e]&&t.hasOwnProperty(e)&&(r[e]=l(e));return n.attr=function(){return t},n}function at(){let t=JSON.parse(JSON.stringify(r)),e=null,n=function(n){e=n,function(){let n=e.svg.select("g.metadata-group"),r=n.selectAll((function(){return this.childNodes}));if(r.filter(`g.${t.legendID}`).size())return;t.index=r.size(),t.legendID=`brush-${t.index}`;let l=n.append("g").classed(`${t.legendID}`,!0).append("g").classed("anchorpoint",!0);l.append("rect").classed("background",!0),l.append("g").classed("innermargin",!0)}(),function(){let n=e.svg.select(`.${t.legendID}`).select("g.anchorpoint"),r=n.select("rect.background"),l=n.select("g.innermargin"),o=e.chartHeight,s=e.xScale,a=t.onChange,i=!1,c=!1,u=0;l.attr("transform","translate(0,0)"),r.attr("x",0).attr("y",0).attr("width",100).attr("height",o).style("fill","white").style("stroke","blue").style("opacity",.45).on("mousemove",(function(t,e,n){let r=d3.select(n[e]);if(r.style("cursor","grab"),c&&i){const t=d3.mouse(n[e]),l=s.invert(t[0]),o=(s.invert(r.attr("x")),+r.attr("x")),i=+r.attr("width");let c=s(l)-u,d=s.domain()[0],p=s.domain()[1],g=c<s(d),f=+(c+i)>s(p);if(c=g?o:c,c=f?o:c,r.attr("x",c),!g&&!f){let t=s.invert(c),e=+r.attr("width"),n=[t,s.invert(c+e)],l=s.copy();l.domain(n),a(l)}}})).on("mouseenter",(function(t,e,n){i=!0})).on("mouseleave",(function(t,e,n){i=!1,c=!1})).on("mousedown",(function(t,e,n){c=!0;let r=d3.select(n[e]).attr("x"),l=d3.mouse(n[e]),o=s.invert(l[0]);u=Math.abs(r-s(o))})).on("mouseup",(function(t,e,n){c=!1}));let d=s.invert(0),p=+r.attr("width"),g=[d,s.invert(0+p)],f=s.copy();f.domain(g),a(f)}()};function l(e){return function(r){return arguments.length?(t[e]=r,n):t[e]}}for(let e in t)!n[e]&&t.hasOwnProperty(e)&&(n[e]=l(e));return n.attr=function(){return t},n.onChange=function(e){return arguments.length?(t.onChange=e,n):t.onChange},n}return e})()));